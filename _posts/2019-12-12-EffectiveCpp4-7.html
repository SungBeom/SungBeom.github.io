---
layout: post
title: "[Effective C++]타입 변환이 모든 매개변수에 대해 적용되어야 한다면 비멤버 함수를 선언하자"
subtitle: "설계 및 선언, 일곱 번째 이야기"
date: 2019-12-12 23:17:00
background: '/img/posts/EffectiveCpp.jpg'
---

<h2 class="section-heading">매개변수의 암시적 타입 변환</h2>

<p style="font-family: NanumGothic">
    "클래스에서 암시적 타입 변환을 지원하는 것은 일반적으로 못된 생각이다"라는 규칙이 있습니다.
    하지만 이 규칙에도 예외가 있는데, 가장 흔한 예외 중 하나가 숫자 타입을 만들 때입니다.
    예를 들어 유리수를 나타내는 클래스를 만들고 있다면, 정수에서 유리수로의 암시적 변환은 허용하자고 판단하더라도 크게 이상하진 않을 것입니다.
    지금부터 보실 코드는 이런 결정에 따라 만든 Rational 클래스입니다.
</p>

<div class="colorscripter-code" style="color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#272727;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #4f4f4f"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#aaa;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div><div style="line-height:130%">10</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">class</span>&nbsp;Rational&nbsp;{</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">public</span>:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;Rational(<span style="color:#4be6fa">int</span>&nbsp;numerator&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#c10aff">0</span>,&nbsp;&nbsp;<span style="color:#999999">//&nbsp;생성자에&nbsp;일부러&nbsp;explicit을&nbsp;붙이지&nbsp;않았습니다.</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#4be6fa">int</span>&nbsp;denominator&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#c10aff">1</span>);&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">//&nbsp;int에서&nbsp;Rational로의&nbsp;암시적&nbsp;변환을&nbsp;허용하기&nbsp;위함입니다.</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#4be6fa">int</span>&nbsp;numerator()&nbsp;<span style="color:#ff3399">const</span>;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#4be6fa">int</span>&nbsp;denominator()&nbsp;<span style="color:#ff3399">const</span>;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">private</span>:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;...</div><div style="padding:0 6px; white-space:pre; line-height:130%">};</div></div><div style="text-align:right;margin-top:-13px;margin-right:5px;font-size:9px;font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#4f4f4f;text-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#4f4f4f;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

<p style="font-family: NanumGothic">
    유리수를 나타내는 클래스이니만큼 덧셈이나 곱셈 등의 수치 연산은 기본으로 지원하고 싶습니다.
    operator*를 Rational의 멤버 함수로 만든다고 생각해 봅시다.
</p>

<div class="colorscripter-code" style="color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#272727;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #4f4f4f"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#aaa;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">class</span>&nbsp;Rational&nbsp;{</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">public</span>:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;...</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">const</span>&nbsp;Rational&nbsp;<span style="color:#ff3399">operator</span><span style="color:#ff3399">*</span>(<span style="color:#ff3399">const</span>&nbsp;Rational<span style="color:#aaffaa"></span><span style="color:#ff3399">&amp;</span>&nbsp;rhs)&nbsp;<span style="color:#ff3399">const</span>;</div><div style="padding:0 6px; white-space:pre; line-height:130%">};</div></div><div style="text-align:right;margin-top:-13px;margin-right:5px;font-size:9px;font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#4f4f4f;text-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#4f4f4f;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

<p style="font-family: NanumGothic">
    이렇게 설계해 두면 유리수 곱셈을 아주 쉽게 할 수 있습니다.
    여기서 더 나아가 혼합형(mixed-mode) 수치 연산도 가능했으면 좋겠습니다.
    바꿔 말해서 Rational을 int 같은 것과도 곱하고 싶다는 것입니다.
    하지만 혼합형 수치 연산을 직접 해보면, 완전하지 않다는 것을 알게 될 것입니다.
</p>

<div class="colorscripter-code" style="color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#272727;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #4f4f4f"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#aaa;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%">Rational&nbsp;oneHalf(<span style="color:#c10aff">1</span>,&nbsp;<span style="color:#c10aff">2</span>);</div><div style="padding:0 6px; white-space:pre; line-height:130%">Rational&nbsp;result;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">result&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">=</span>&nbsp;oneHalf&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">*</span>&nbsp;<span style="color:#c10aff">2</span>;&nbsp;&nbsp;<span style="color:#999999">//&nbsp;가능,&nbsp;oneHalf.operator*(2);</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">result&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#c10aff">2</span>&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">*</span>&nbsp;oneHalf;&nbsp;&nbsp;<span style="color:#999999">//&nbsp;불가능,&nbsp;2.operator*(oneHalf);</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#999999">//&nbsp;operator*(2,&nbsp;oneHalf);</span></div></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#4f4f4f;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

<p style="font-family: NanumGothic">
    첫 번째 줄에서 oneHalf 객체는 operator* 함수를 멤버로 갖고 있는 클래스의 인스턴스이므로, 컴파일러는 이 함수를 호출합니다.
    하지만 두 번째 줄에서 정수 2에는 클래스 같은 것이 연관되어 있지 않기 때문에, operator* 멤버 함수도 있을 리가 없습니다.
    컴파일러는 아래처럼 호출할 수 있는 비멤버 버전의 operator*(네임스페이스 혹은 전역 유효범위에 있는 operator*)도 찾아봅니다.
    그러나 위 예제에서는 int와 Rational을 취하는 비멤버 버전의 operator*가 없으므로 탐색은 실패하고 컴파일 에러가 나게 됩니다.
</p>

<p style="font-family: NanumGothic">
    그렇다면 두 번째 매개변수가 정수 2인 함수는 성공한 것일까요?
    이유는 바로 암시적 타입 변환(implicit type conversion)에 있습니다.
    컴파일러는 여러분이 이 함수에 int를 넘겼으며 함수 쪽에선 Rational을 요구한다는 사실을 알고 있기에, 이 int를 Rational 클래스의 생성자에 주어 호출하여 Rational로 둔갑시킵니다.
    다시 말해, 마치 아래와 같이 작성된 코드인 것처럼 처리한 거죠.
</p>

<div class="colorscripter-code" style="color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#272727;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #4f4f4f"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#aaa;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">const</span>&nbsp;Rational&nbsp;temp(<span style="color:#c10aff">2</span>);&nbsp;&nbsp;&nbsp;<span style="color:#999999">//&nbsp;2로부터&nbsp;임시&nbsp;Rational&nbsp;객체를&nbsp;생성합니다.</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">result&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">=</span>&nbsp;oneHalf&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">*</span>&nbsp;temp;&nbsp;&nbsp;<span style="color:#999999">//&nbsp;oneHalf.operator*(temp);</span></div></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#4f4f4f;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

<p style="font-family: NanumGothic">
    물론 컴파일러가 이렇게 동작한 것은 명시호출(explicit)로 선언되지 않은 생성자가 있기 때문입니다.
    Rational 생성자가 만약 명시호출 생성자였으면 컴파일되지 않았을 것입니다.
    이로써 알 수 있는 사실은, 암시적 타입 변환에 대해 매개변수가 먹혀들려면 <strong>매개변수 리스트에 들어 있어야만 한다</strong>는 것입니다.
    그러니까 호출되는 멤버 함수를 갖고 있는(쉽게 말해 this가 가리키는) 객체에 해당하는 암시적 매개변수에는 암시적 변환이 먹히지 않습니다.
    따라서 앞의 예제도 첫 번째 문장은 컴파일되고 두 번째 문장이 컴파일되지 않는 것이죠.
</p>

<h2 class="section-heading">해답은 비멤버 함수</h2>

<p style="font-family: NanumGothic">
    혼합형 수치 지원을 하는 해답은 바로 operator*를 비멤버 함수로 만들어서, 컴파일러 쪽에서 모든 인자에 대해 암시적 타입 변환을 수행하도록 내버려 두는 것입니다.
</p>

<div class="colorscripter-code" style="color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#272727;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #4f4f4f"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#aaa;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div><div style="line-height:130%">10</div><div style="line-height:130%">11</div><div style="line-height:130%">12</div><div style="line-height:130%">13</div><div style="line-height:130%">14</div><div style="line-height:130%">15</div><div style="line-height:130%">16</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#f0f0f0;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">class</span>&nbsp;Rational&nbsp;{</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;<span style="color:#999999">//&nbsp;operator*가&nbsp;없습니다.</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">};</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#ff3399">const</span>&nbsp;Rational&nbsp;<span style="color:#ff3399">operator</span><span style="color:#ff3399">*</span>(<span style="color:#ff3399">const</span>&nbsp;Rational<span style="color:#aaffaa"></span><span style="color:#ff3399">*</span>&nbsp;lhs,</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">const</span>&nbsp;Rationa;<span style="color:#aaffaa"></span><span style="color:#ff3399">&amp;</span>&nbsp;rhs)&nbsp;&nbsp;<span style="color:#999999">//&nbsp;이제는&nbsp;비멤버&nbsp;함수입니다.</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">{</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#ff3399">return</span>&nbsp;Rational(lhs.numerator()&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">*</span>&nbsp;rhs.numerator(),</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;lhs.denominator()&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">*</span>&nbsp;rhs.denominator());</div><div style="padding:0 6px; white-space:pre; line-height:130%">}</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">Rational&nbsp;oneFourth(<span style="color:#c10aff">1</span>,&nbsp;<span style="color:#c10aff">4</span>);</div><div style="padding:0 6px; white-space:pre; line-height:130%">Rational&nbsp;result;</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;</div><div style="padding:0 6px; white-space:pre; line-height:130%">result&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">=</span>&nbsp;oneFourth&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">*</span>&nbsp;<span style="color:#c10aff">2</span>;</div><div style="padding:0 6px; white-space:pre; line-height:130%">result&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">=</span>&nbsp;<span style="color:#c10aff">2</span>&nbsp;<span style="color:#aaffaa"></span><span style="color:#ff3399">*</span>&nbsp;oneFourth;</div></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#4f4f4f;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

<p style="font-family: NanumGothic">
    해결은 했으나, 진정 operator* 함수는 Rational 클래스의 프렌드 함수로 두어도 될까요?
    지금의 예제에서는 '아니오'라고 답해야 옳습니다.
    operator*는 완전히 Rational의 public 인터페이스만을 써서 구현할 수 있기 때문입니다.
    여기서 한 가지 중요한 결론은 "멤버 함수의 반대는 프렌드 함수가 아니라 <strong>비멤버</strong> 함수이다"라는 것입니다.
    어떤 클래스와 연관 관계를 맺어 놓고는 싶은데 멤버 함수이면 안 되는(모든 인자에 대해 타입 변환이 필요하다든가 하는 이유로) 함수에 대해, 이런 것들을 프렌드 함수로 만든다고 다 해결되진 않습니다.
</p>

<p style="font-family: NanumGothic">
    <i>Rational을 클래스가 아닌 <strong>템플릿</strong>으로 만들다 보면, 고민해야 할 문제점이 지금 것과 다르고 이것을 해결하는 방법도 또 다르며, 설계 관련 사항들도 완전히 다릅니다.</i>
</p>

<br>

<h2 class="section-heading" style="color: red">정리</h2>

<p style="font-family: NanumGothic">
    어떤 함수에 들어가는 모든 매개변수(this 포인터가 가리키는 객체도 포함해서)에 대해 타입 변환을 해 줄 필요가 있다면, 그 함수는 비멤버이어야 합니다.
</p>
